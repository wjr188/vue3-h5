import{_ as H}from"./back-DXvGtdGP.js";import{_ as M}from"./loading-DSJ59oo9.js";import{_ as V}from"./share2-DEdzc1xC.js";import{d as U,y as L,u as P,q as h,r as o,o as E,s as $,c,a as u,b as e,v as I,t as k,h as R,F as j,e as A,M as y}from"./index-CKjozqaQ.js";import{u as G}from"./useHistoryStore-DEf3NF2P.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"image-detail-wrapper"},W={class:"top-bar"},X={class:"left"},Y={class:"avatar"},Z={class:"name"},ee={class:"album-title"},ae={class:"image-grid"},te=["onClick"],se={key:0,class:"loading-tip"},oe={key:1,class:"no-more-tip"},le={class:"bottom-bar"},ne=["src"],ie=["src"],w=18,re=U({__name:"StarImageDetail",setup(ce){const v=L(),S=P(),N=G(),d=h(()=>{const t=v.params.data;if(t)try{const a=decodeURIComponent(t);return JSON.parse(a)}catch(a){console.error("Failed to parse JSON from route:",a)}if(v.query.fromHistory==="1"&&v.query.fullData)try{return JSON.parse(decodeURIComponent(String(v.query.fullData)))}catch(a){console.error("Failed to parse JSON from query:",a)}return{}}),m=o(!1),_=o(!1),l=o(d.value.likes||0),n=o(d.value.favs||0),f=h(()=>d.value.star||{}),s=h(()=>d.value.album||{images:[]}),g=h(()=>s.value.images||[]),i=o([]),r=o(!1),p=o(!1),b=o(null);function B(){r.value||p.value||(r.value=!0,setTimeout(()=>{const t=i.value.length+w;i.value=g.value.slice(0,t),i.value.length>=g.value.length&&(p.value=!0),r.value=!1},500))}function F(){const t=b.value;if(!t)return;t.scrollTop+t.clientHeight+50>=t.scrollHeight&&!r.value&&!p.value&&B()}E(()=>{i.value=g.value.slice(0,w),N.addRecord({id:String(s.value.id??s.value.title??"unknown"),type:"only_img",time:new Date().toISOString(),data:{album:s.value,star:f.value,cover:s.value.cover||g.value[0],title:s.value.title||"无标题",likes:l.value,favs:n.value,index:0}})});function O(){m.value=!m.value,m.value?(l.value++,y("点赞成功")):(l.value--,y("取消点赞"))}function q(){_.value=!_.value,_.value?(n.value++,y("收藏成功")):(n.value--,y("取消收藏"))}function J(){S.back()}function T(t){const a={album:s.value,star:f.value,likes:l.value,favs:n.value,index:t};S.push({name:"FullImageViewer",params:{data:encodeURIComponent(JSON.stringify(a))}})}function x(){S.push({name:"PromotionShare"})}return(t,a)=>{const C=$("lazy");return u(),c("div",Q,[e("div",W,[e("div",X,[e("img",{src:H,class:"back-icon",onClick:J}),I(e("img",Y,null,512),[[C,f.value.avatar]]),e("div",Z,k(f.value.name),1)])]),e("div",{class:"scroll-content",ref_key:"scrollRef",ref:b,onScroll:F},[e("div",ee,k(s.value.title),1),e("div",ae,[(u(!0),c(j,null,A(i.value,(z,D)=>I((u(),c("img",{key:D,class:"image",onClick:ue=>T(D)},null,8,te)),[[C,z]])),128))]),r.value?(u(),c("div",se,a[0]||(a[0]=[e("img",{src:M,class:"loading-icon"},null,-1),e("span",null,"客官别走，妾身马上就好~",-1)]))):R("",!0),p.value?(u(),c("div",oe," 客官，妾身被你弄高潮了，扛不住了~ ")):R("",!0)],544),e("div",le,[e("div",{class:"icon-btn",onClick:O},[e("img",{src:m.value?"/icons/dianzan5.svg":"/icons/like1.svg"},null,8,ne),e("span",null,k(l.value),1)]),e("div",{class:"icon-btn",onClick:q},[e("img",{src:_.value?"/icons/star7.svg":"/icons/star.svg"},null,8,ie),e("span",null,k(n.value),1)]),e("div",{class:"icon-btn",onClick:x},a[1]||(a[1]=[e("img",{src:V},null,-1),e("span",null,"分享",-1)]))])])}}}),pe=K(re,[["__scopeId","data-v-1510968a"]]);export{pe as default};
