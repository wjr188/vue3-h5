import{d as _e,y as ge,u as fe,r as s,q as he,o as ke,p as i,k as Ee,C as Te,s as be,c as L,a as R,b as a,m as ee,h as te,w as k,t as y,l as Ie,O as Ae,F as Ce,e as Se,f as Le,v as U,D as ae,z as F,n as N}from"./index-CKjozqaQ.js";import{_ as W}from"./dynamic-import-helper-BheWnx7M.js";import{_ as Re}from"./back1-BriTIMyR.js";import{_ as ye}from"./share2-DEdzc1xC.js";import{_ as De,a as we,b as Pe}from"./catalog-BTiaQNIF.js";import{C as Ve}from"./ChapterDrawer-CFwy4oMB.js";import{u as je}from"./useHistoryStore-DEf3NF2P.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./back3-q87-H97k.js";const Oe=""+new URL("../icons/vertical-flip.svg",import.meta.url).href,Fe=""+new URL("../icons/horizontal-flip.svg",import.meta.url).href,Me={class:"reader-top-bar"},He={class:"chapter-title"},ze={key:0,class:"top-tip-message"},qe=["data-flip-mode"],$e=["data-page-index"],Ue={class:"progress-bar-container"},Ne={class:"page-label"},We=["max"],Be={class:"page-label"},Ge={class:"bottom-buttons"},Je=["src"],Ke={key:0,class:"auto-flip-panel"},Qe={class:"speed-label"},Xe={class:"speed-slider"},Ye=_e({__name:"ComicReader",setup(Ze){const M=ge(),b=fe();function oe(){b.push("/promotion-share")}const d=s(null),m=s(null),_=s([]),D=s(""),B=s(""),w=s([]),H=s(""),c=s(0),n=s("vertical"),P=s(!1),I=s(!0),p=s(null),g=s(1),f=he(()=>w.value.length),A=s(!1),V=s(3);let E=null;const z=s(!1),q=s(!1),G=t=>x(!0),j=s("");let C=null;const $=s(!1),h=s({}),le={1:.5,2:1,3:1.5,4:2,5:2.5,6:3},ie=()=>{$.value||(I.value=!I.value,I.value&&(A.value=!1))},re=()=>{A.value=!0,I.value=!1},se=()=>{A.value=!1,q.value=!0,z.value=!0;const t=p.value;if(!t)return;const e=le[V.value],u=()=>{if(!z.value){E&&cancelAnimationFrame(E);return}let l,r,v;if(n.value==="vertical"?(l=t.scrollTop,r=t.scrollHeight-t.clientHeight,v=t.clientHeight):(l=t.scrollLeft,r=t.scrollWidth-t.clientWidth,v=t.clientWidth),l<r){n.value==="vertical"?(t.scrollTop+=e,t.scrollTop>r&&(t.scrollTop=r),l=t.scrollTop):(t.scrollLeft+=e,t.scrollLeft>r&&(t.scrollLeft=r),l=t.scrollLeft);let o=0;if(f.value>0){if(n.value==="vertical"){let S=0;const Y=t.querySelectorAll(".comic-page-img");for(let O=0;O<Y.length;O++){const Z=Y[O].offsetHeight;if(l>=S&&l<S+Z){o=O;break}S+=Z}}else{const S=Math.round(l/v);o=Math.min(S*2,f.value-1)}o=Math.max(0,o),c.value!==o&&(c.value=o,g.value=o+1)}E=requestAnimationFrame(u)}else T(),f.value>0&&(c.value=f.value-1,g.value=f.value)};E=requestAnimationFrame(u)},T=()=>{z.value=!1,q.value=!1,E&&(cancelAnimationFrame(E),E=null),A.value=!1,p.value&&(p.value.style.scrollSnapType=n.value==="vertical"?"y mandatory":"x mandatory")},J=t=>{j.value=t,C&&clearTimeout(C),C=setTimeout(()=>j.value="",2e3)},K=async(t,e)=>{try{if(!t||!e)return;const u=await W(Object.assign({"../mock/acg/comic/chapter/1_1.js":()=>i(()=>import("./1_1-DTCd7SiF.js"),[],import.meta.url),"../mock/acg/comic/chapter/1_2.js":()=>i(()=>import("./1_2-zZQJg1jI.js"),[],import.meta.url),"../mock/acg/comic/chapter/1_3.js":()=>i(()=>import("./1_3-DTCd7SiF.js"),[],import.meta.url)}),`../mock/acg/comic/chapter/${t}_${e}.js`,6);w.value=u.default.images||[];const r=((await W(Object.assign({"../mock/acg/comic/detail/1.js":()=>i(()=>import("./1-fzo8JEYb.js").then(o=>o._),[],import.meta.url),"../mock/acg/comic/detail/10.js":()=>i(()=>import("./10-CgmEdRt1.js").then(o=>o._),[],import.meta.url),"../mock/acg/comic/detail/11.js":()=>i(()=>import("./11-CabwFj8e.js").then(o=>o._),[],import.meta.url),"../mock/acg/comic/detail/2.js":()=>i(()=>import("./2-CuUYKjVo.js").then(o=>o._),[],import.meta.url),"../mock/acg/comic/detail/3.js":()=>i(()=>import("./3-CDSPaFCZ.js").then(o=>o._),[],import.meta.url),"../mock/acg/comic/detail/4.js":()=>i(()=>import("./4-DpjjeBM5.js").then(o=>o._),[],import.meta.url),"../mock/acg/comic/detail/5.js":()=>i(()=>import("./5-BY--KaCV.js").then(o=>o._),[],import.meta.url),"../mock/acg/comic/detail/6.js":()=>i(()=>import("./6-BUa2zK63.js").then(o=>o._),[],import.meta.url),"../mock/acg/comic/detail/7.js":()=>i(()=>import("./7-6vga_5yu.js").then(o=>o._),[],import.meta.url),"../mock/acg/comic/detail/8.js":()=>i(()=>import("./8-0KauOiHy.js").then(o=>o._),[],import.meta.url),"../mock/acg/comic/detail/9.js":()=>i(()=>import("./9-laFEHVAn.js").then(o=>o._),[],import.meta.url)}),`../mock/acg/comic/detail/${t}.js`,6)).default.chapters||[]).find(o=>String(o.id)===String(e));H.value=r?r.title:"",p.value&&(p.value.scrollTop=0,p.value.scrollLeft=0);const v=h.value[e];v!==void 0?setTimeout(()=>{ce(v)},100):(c.value=0,g.value=1)}catch{w.value=[],H.value=""}},ce=t=>{c.value=t,g.value=t+1,N(()=>{const e=p.value?.querySelectorAll(".comic-page-img");e&&e[t]&&e[t].scrollIntoView({behavior:"auto",block:n.value==="vertical"?"start":void 0,inline:n.value==="horizontal"?"start":void 0})})},ne=()=>{d.value?b.replace({name:"ComicDetail",params:{id:d.value}}):b.replace("/")},ue=()=>{const t=_.value.findIndex(e=>String(e.id)===String(m.value));t>0?(T(),h.value[String(m.value)]=c.value,b.push({name:"ComicReader",params:{comicId:d.value,chapterId:_.value[t-1].id}})):J("这是第一话哦~")},me=()=>{const t=_.value.findIndex(e=>String(e.id)===String(m.value));t<_.value.length-1?(T(),h.value[String(m.value)]=c.value,b.push({name:"ComicReader",params:{comicId:d.value,chapterId:_.value[t+1].id}})):J("这是最后一话哦~")},ve=t=>{P.value=!1,T(),$.value=!0,h.value[String(m.value)]=c.value,b.push({name:"ComicReader",params:{comicId:d.value,chapterId:t}}).then(()=>{setTimeout(()=>{$.value=!1},200)})},Q=t=>{n.value=t,T(),h.value[String(m.value)]=c.value,N(()=>{requestAnimationFrame(()=>{if(p.value){const e=p.value.querySelector(`img[data-page-index="${c.value}"]`);e&&(t==="vertical"?e.scrollIntoView({behavior:"instant",block:"start"}):e.scrollIntoView({behavior:"instant",inline:"start"}))}})})},de=()=>{const t=p.value;if(!t||f.value===0)return;const e=t.querySelectorAll(".comic-page-img");if(n.value==="vertical"){const u=t.scrollTop;let l=0;for(let r=0;r<e.length;r++){const v=e[r].offsetHeight;if(u>=l&&u<l+v){c.value=r,g.value=r+1,h.value[String(m.value)]=r;break}l+=v}}else{const u=t.scrollLeft,l=t.clientWidth,r=Math.round(u/l),v=Math.min(r*2,f.value-1);c.value=v,g.value=v+1,h.value[String(m.value)]=v}},pe=()=>{c.value=Number(g.value)-1,h.value[String(m.value)]=c.value,N(()=>{const t=p.value?.querySelectorAll(".comic-page-img");t&&t[c.value]&&t[c.value].scrollIntoView({behavior:"auto",block:n.value==="vertical"?"start":void 0,inline:n.value==="horizontal"?"start":void 0})})};let X=0;function x(t=!1){const e=Date.now();if(!(!t&&e-X<60*1e3)&&(X=e,d.value)){const u=je(),l=_.value.findIndex(r=>String(r.id)===String(m.value));u.addRecord({id:d.value,type:"comic",time:new Date().toISOString(),data:{title:D.value||"未命名漫画",cover:B.value||"",episodes:_.value.length||0,lastRead:l>=0?l+1:1}})}}return ke(async()=>{d.value=M.params.comicId,m.value=M.params.chapterId,await K(d.value,m.value);let t=null;try{t=await W(Object.assign({"../mock/acg/comic/detail/1.js":()=>i(()=>import("./1-fzo8JEYb.js").then(e=>e._),[],import.meta.url),"../mock/acg/comic/detail/10.js":()=>i(()=>import("./10-CgmEdRt1.js").then(e=>e._),[],import.meta.url),"../mock/acg/comic/detail/11.js":()=>i(()=>import("./11-CabwFj8e.js").then(e=>e._),[],import.meta.url),"../mock/acg/comic/detail/2.js":()=>i(()=>import("./2-CuUYKjVo.js").then(e=>e._),[],import.meta.url),"../mock/acg/comic/detail/3.js":()=>i(()=>import("./3-CDSPaFCZ.js").then(e=>e._),[],import.meta.url),"../mock/acg/comic/detail/4.js":()=>i(()=>import("./4-DpjjeBM5.js").then(e=>e._),[],import.meta.url),"../mock/acg/comic/detail/5.js":()=>i(()=>import("./5-BY--KaCV.js").then(e=>e._),[],import.meta.url),"../mock/acg/comic/detail/6.js":()=>i(()=>import("./6-BUa2zK63.js").then(e=>e._),[],import.meta.url),"../mock/acg/comic/detail/7.js":()=>i(()=>import("./7-6vga_5yu.js").then(e=>e._),[],import.meta.url),"../mock/acg/comic/detail/8.js":()=>i(()=>import("./8-0KauOiHy.js").then(e=>e._),[],import.meta.url),"../mock/acg/comic/detail/9.js":()=>i(()=>import("./9-laFEHVAn.js").then(e=>e._),[],import.meta.url)}),`../mock/acg/comic/detail/${d.value}.js`,6),_.value=t.default.chapters||[],D.value=t.default.title||"",B.value=t.default.cover||""}catch{_.value=[],D.value=""}x()}),Ee(()=>M.params.chapterId,async(t,e)=>{t!==e&&(m.value=t,await K(d.value,t),x())}),Te(()=>{T(),C&&clearTimeout(C),x(),typeof window<"u"&&window.removeEventListener("beforeunload",G)}),typeof window<"u"&&window.addEventListener("beforeunload",G),(t,e)=>{const u=be("lazy");return R(),L("div",{class:F(["comic-reader-wrapper",{"show-controls":I.value}]),onClick:ie},[a("div",Me,[a("img",{src:Re,class:"back-icon",onClick:k(ne,["stop"])}),a("span",He,y(H.value),1),a("img",{src:ye,class:"share-icon",onClick:k(oe,["stop"])})]),ee(Ae,{name:"fade"},{default:Ie(()=>[j.value?(R(),L("div",ze,y(j.value),1)):te("",!0)]),_:1}),a("div",{class:"comic-pages-container hide-scrollbar",ref_key:"pagesContainer",ref:p,"data-flip-mode":n.value,style:Le({"scroll-snap-type":n.value==="horizontal"?"x mandatory":"none"}),onScroll:de},[(R(!0),L(Ce,null,Se(w.value,(l,r)=>U((R(),L("img",{key:r,class:"comic-page-img","data-page-index":r},null,8,$e)),[[u,l]])),128))],44,qe),a("div",{class:"chapter-nav-btn prev-chapter-btn",onClick:k(ue,["stop"])},e[6]||(e[6]=[a("div",{class:"chapter-nav-text prev-text"},"上一话",-1),a("img",{src:De,class:"chapter-nav-icon"},null,-1)])),a("div",{class:"chapter-nav-btn next-chapter-btn",onClick:k(me,["stop"])},e[7]||(e[7]=[a("div",{class:"chapter-nav-text next-text"},"下一话",-1),a("img",{src:we,class:"chapter-nav-icon"},null,-1)])),a("div",{class:F(["reader-bottom-bar",{"show-controls":I.value}])},[a("div",Ue,[a("span",Ne,y(c.value+1),1),U(a("input",{type:"range",min:1,max:f.value,"onUpdate:modelValue":e[0]||(e[0]=l=>g.value=l),onChange:pe},null,40,We),[[ae,g.value]]),a("span",Be,y(f.value),1)]),a("div",Ge,[a("div",{class:"bottom-control-item",onClick:e[1]||(e[1]=k(l=>P.value=!0,["stop"]))},e[8]||(e[8]=[a("img",{src:Pe},null,-1),a("span",null,"目录",-1)])),a("div",{class:F(["bottom-control-item",{active:n.value==="vertical"}]),onClick:e[2]||(e[2]=k(l=>Q("vertical"),["stop"]))},e[9]||(e[9]=[a("img",{src:Oe},null,-1),a("span",null,"上下翻",-1)]),2),a("div",{class:F(["bottom-control-item",{active:n.value==="horizontal"}]),onClick:e[3]||(e[3]=k(l=>Q("horizontal"),["stop"]))},e[10]||(e[10]=[a("img",{src:Fe},null,-1),a("span",null,"左右翻",-1)]),2),a("div",{class:"bottom-control-item",onClick:k(re,["stop"])},[a("img",{src:q.value?"/icons/pause1.svg":"/icons/auto-flip.svg"},null,8,Je),e[11]||(e[11]=a("span",null,"自动翻",-1))])])],2),ee(Ve,{modelValue:P.value,"onUpdate:modelValue":e[4]||(e[4]=l=>P.value=l),chapters:_.value,"comic-id":d.value||"","comic-title":D.value,fullScreen:!1,onReadChapterFromDrawer:ve},null,8,["modelValue","chapters","comic-id","comic-title"]),A.value?(R(),L("div",Ke,[a("div",Qe,"自动翻页速度 "+y(V.value),1),a("div",Xe,[e[12]||(e[12]=a("span",null,"减速",-1)),U(a("input",{type:"range",min:"1",max:"6","onUpdate:modelValue":e[5]||(e[5]=l=>V.value=l)},null,512),[[ae,V.value]]),e[13]||(e[13]=a("span",null,"加速",-1))]),a("div",{class:"button-group"},[a("button",{class:"stop-btn",onClick:T},"结束自动翻页"),a("button",{class:"start-btn",onClick:se},"开始")])])):te("",!0)],2)}}}),nt=xe(Ye,[["__scopeId","data-v-bfcaa66e"]]);export{nt as default};
