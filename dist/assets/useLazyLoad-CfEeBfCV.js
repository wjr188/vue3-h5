import{r as v,o as x,n as g,C,k as O}from"./index-CKjozqaQ.js";function z(o,S={}){const{batchSize:b=2,scrollOffset:y=200,namespace:p="",uniqueProps:d={}}=S,n=v([]),c=v(!1),l=v(!1),s=v(null),a=v(0),h=v(!1);let u=null;const w=()=>{let e=`lazyLoad_${window.location.pathname}`;if(p&&(e+=`_${p}`),d&&Object.keys(d).length>0)for(const[t,i]of Object.entries(d))e+=`_${t}:${i}`;return e};function I(e){if(!e)return null;let t=e.parentElement;for(;t;){if((t.classList?.contains("swiper-slide-active")||t.classList?.contains("slide-content"))&&t.scrollHeight>t.clientHeight)return t;t=t.parentElement}return document.documentElement}function _(){const e=window.innerHeight,t=Math.ceil(e/400);return Math.max(b,t*1.5)}async function f(){if(c.value||l.value)return;c.value=!0,await new Promise(M=>setTimeout(M,200));const e=Math.ceil(_()),t=n.value.length,i=o.value.slice(t,t+e);if(i.length===0){l.value=!0,c.value=!1,r();return}if(n.value.push(...i),a.value=n.value.length,c.value=!1,a.value>=o.value.length){l.value=!0,r();return}u?.unobserve(s.value),u?.observe(s.value)}async function $(e){const t=Math.min(e,o.value.length);n.value.length<t?(n.value=o.value.slice(0,t),a.value=n.value.length,a.value>=o.value.length&&(l.value=!0,r()),await g(),m(),u?.unobserve(s.value),u?.observe(s.value)):n.value.length>=o.value.length&&(l.value=!0,r())}function m(){if(!s.value||l.value){r();return}g(()=>{r();const e=I(s.value);!s.value||!e||(u=new IntersectionObserver(t=>{t[0].isIntersecting&&f()},{root:e,rootMargin:`${y}px`}),u.observe(s.value))})}function r(){u&&(u.disconnect(),u=null)}return x(async()=>{const e=w(),t=sessionStorage.getItem(`${e}_loadedCount`),i=sessionStorage.getItem(`${e}_scrollTop`);t?(a.value=parseInt(t,10),n.value=o.value.slice(0,a.value),h.value=!0,a.value>=o.value.length&&(l.value=!0),await g(),requestAnimationFrame(()=>{i&&window.scrollTo(0,parseInt(i,10))})):f(),m()}),C(()=>{const e=w();l.value?sessionStorage.removeItem(`${e}_loadedCount`):sessionStorage.setItem(`${e}_loadedCount`,a.value.toString()),sessionStorage.setItem(`${e}_scrollTop`,window.scrollY.toString()),r()}),O(o,(e,t)=>{if(e!==t){if(h.value){h.value=!1;return}n.value=[],a.value=0,l.value=!1,c.value=!1,e.length>0?g(()=>{m(),f()}):(r(),l.value=!0,n.value=[])}},{deep:!1}),{visibleList:n,isLoading:c,noMore:l,sentinel:s,loadNextBatch:f,loadUntil:$,destroyObserver:r}}export{z as u};
