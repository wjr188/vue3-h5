import{d as te,J as be,u as oe,r as o,q as X,o as ne,A as we,c as u,a as r,z as H,h,j as Ce,f as Y,w as f,b as e,l as _e,v as Z,t as g,i as N,D as xe,F as z,e as W,I as he,O as Se,n as Pe,y as $e,m as Ve,x as ee,M as q}from"./index-CKjozqaQ.js";import{_ as Ie}from"./back1-BriTIMyR.js";import{_ as Te}from"./share2-DEdzc1xC.js";import{H as se,_ as Be}from"./hls-AJDOUA6Y.js";import{s as Me}from"./function-call-Cn_FLeOo.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Fe}from"./useHistoryStore-DEf3NF2P.js";import"./index-BvDqeyKw.js";const Le=""+new URL("../icons/line-switch.svg",import.meta.url).href,Ne=""+new URL("../icons/rewind.svg",import.meta.url).href,Re=""+new URL("../icons/forward.svg",import.meta.url).href,Ee=["src","poster","controls"],qe=["src"],Ue={class:"time"},Oe=["max"],Ae=["src"],De={key:0,class:"speed-panel"},He=["onClick"],ze=["src"],We=te({__name:"VideoPlayer",props:{src:{},poster:{}},emits:["play"],setup(Q,{emit:v}){const c=be(),U=oe(),d=Q,S=v,t=o(null),P=o(null),y=o(null),w=o(!1),x=o(!1),$=o(!1),R=o(0),p=o(0),k=o(0),E=o(0);let C=!1;const _=o(!1),m=o(!1),V=o(!1);let I=null;const T=o(!1),O=[.75,1,1.25,1.75,2],F=o(1),L=()=>T.value=!T.value,A=n=>{F.value=n,t.value&&(t.value.playbackRate=n),T.value=!1};function i(){return document.createElement("video").canPlayType("application/vnd.apple.mpegurl")!==""}const s=navigator.userAgent,a=/Android|webOS|iPhone|iPad|iPod|IEMobile|Opera Mini/i.test(s),D=/Quark|QQBrowser|UCBrowser|UBrowser|VivoBrowser|HuaweiBrowser|MiuiBrowser|Sogou|360|Baidu|HeyTapBrowser|OPPO|Qiyu|MetaSr/i.test(s),B=a&&(D||i()),ae=X(()=>m.value?{}:{pointerEvents:_.value?"auto":"none"});function ie(){if(!_.value)return J();m.value||me()}async function J(){if(!c.isVIP){if(!c.canWatchLongVideo()){await Me({title:"温馨提示",message:"长视频观看次数已用完，请开通VIP",confirmButtonText:"立即开通",cancelButtonText:"取消",className:"vip-dialog",closeOnClickOverlay:!0}).then(()=>{U.push("/VIP")}).catch(()=>{console.log("用户取消或关闭弹窗")});return}c.consumeLongVideo()}_.value=!0,Pe(()=>{t.value&&(t.value.style.pointerEvents="auto",t.value.playbackRate=F.value,t.value.play()),m.value=B,B||(V.value=!0,M())})}const j=n=>{t.value&&(t.value.currentTime=Math.min(Math.max(0,t.value.currentTime+n),p.value),M())},re=()=>{t.value&&(t.value.paused?(t.value.play(),w.value=!0):(t.value.pause(),w.value=!1),M())},ue=()=>{t.value&&(t.value.muted=!t.value.muted,$.value=t.value.muted,M())},ce=()=>{p.value=t.value?.duration||0},ve=()=>{C=!0,clearTimeout(I)},de=()=>{t.value&&(t.value.currentTime=k.value,C=!1,M())},G=n=>{const l=String(Math.floor(n/60)).padStart(2,"0"),b=String(Math.floor(n%60)).padStart(2,"0");return`${l}:${b}`},pe=X(()=>{const n=k.value/p.value*100,l=E.value/p.value*100;return{background:`linear-gradient(to right, #f00 0%, #f00 ${n}%, #aaa ${n}%, #aaa ${l}%, #444 ${l}%, #444 100%)`}}),K=()=>{if(t.value&&!C&&!m.value&&!t.value.paused){R.value=t.value.currentTime,p.value=t.value.duration,k.value=t.value.currentTime;const n=t.value.buffered;n.length&&(E.value=n.end(n.length-1))}requestAnimationFrame(K)};K();function me(){V.value=!0,M()}function M(){clearTimeout(I),I=setTimeout(()=>V.value=!1,2500)}function fe(){const n=P.value;n&&(document.fullscreenElement?document.exitFullscreen():(n.requestFullscreen(),m.value=!1))}function ge(){x.value=!0,m.value=B}function ye(){x.value=!1,m.value=B,document.fullscreenElement&&document.exitFullscreen()}function ke(){_.value=!0,w.value=!0,S("play")}return ne(()=>{const n=t.value;!n||!d.src||(!B&&se.isSupported()&&d.src.endsWith(".m3u8")?(y.value=new se,y.value.loadSource(d.src),y.value.attachMedia(n)):n.src=d.src,document.addEventListener("fullscreenchange",()=>{x.value=!!document.fullscreenElement}))}),we(()=>{t.value&&(t.value.pause(),t.value.removeAttribute("src"),t.value.load()),y.value?.destroy(),clearTimeout(I)}),(n,l)=>(r(),u("div",{class:H(["video-wrapper",{fullscreen:x.value}]),onClick:ie,ref_key:"wrapperRef",ref:P},[d.src?(r(),u("video",{key:0,ref_key:"video",ref:t,class:"video",src:d.src,poster:d.poster,playsinline:"","webkit-playsinline":"",preload:"metadata",controls:m.value,controlslist:"nodownload noremoteplayback",onContextmenu:l[0]||(l[0]=f(()=>{},["prevent"])),onLoadeddata:ce,onWebkitbeginfullscreen:ge,onWebkitendfullscreen:ye,onPlay:ke,tabindex:"-1",style:Y(ae.value)},null,44,Ee)):h("",!0),_.value?h("",!0):(r(),u("div",{key:1,class:"center-icon",onClick:f(J,["stop"])},l[5]||(l[5]=[e("img",{src:Be,class:"play-icon"},null,-1)]))),_.value&&!m.value?(r(),Ce(Se,{key:2,name:"fade"},{default:_e(()=>[Z(e("div",{class:"control-bar",onClick:l[4]||(l[4]=f(()=>{},["stop"]))},[e("button",{class:"btn",onClick:l[1]||(l[1]=f(b=>j(-10),["stop"]))},l[6]||(l[6]=[e("img",{src:Ne,class:"icon"},null,-1)])),e("button",{class:"btn",onClick:f(re,["stop"])},[e("img",{src:w.value?"/icons/pause.svg":"/icons/play1.svg",class:"icon"},null,8,qe)]),e("button",{class:"btn",onClick:l[2]||(l[2]=f(b=>j(10),["stop"]))},l[7]||(l[7]=[e("img",{src:Re,class:"icon"},null,-1)])),e("div",Ue,g(G(N(C)?k.value:R.value))+" / "+g(G(p.value)),1),e("div",{class:H(["progress-container",{dragging:N(C)}])},[e("div",{class:"buffered",style:Y(pe.value)},null,4),Z(e("input",{type:"range",class:H(["progress",{dragging:N(C)}]),min:"0",max:p.value,step:"0.1","onUpdate:modelValue":l[3]||(l[3]=b=>k.value=b),onInput:ve,onChange:de},null,42,Oe),[[xe,k.value]])],2),e("button",{class:"btn",onClick:f(ue,["stop"])},[e("img",{src:$.value?"/icons/volume-mute.svg":"/icons/volume.svg",class:"icon"},null,8,Ae)]),e("div",{class:"btn speed-selector",onClick:f(L,["stop"])},[e("span",null,g(F.value.toFixed(2))+"x",1),T.value?(r(),u("div",De,[(r(),u(z,null,W(O,b=>e("div",{key:b,class:"speed-option",onClick:ps=>A(b)},g(b)+"x ",9,He)),64))])):h("",!0)]),e("button",{class:"btn",onClick:f(fe,["stop"])},[e("img",{src:x.value?"/icons/exit-fullscreen.svg":"/icons/fullscreen.svg",class:"icon"},null,8,ze)])],512),[[he,V.value]])]),_:1})):h("",!0)],2))}}),Qe=le(We,[["__scopeId","data-v-0b9d81ac"]]),Je={class:"play-page"},je={key:0,class:"preview-mask"},Ge={class:"info-box"},Ke={class:"video-title"},Xe={class:"tags"},Ye={class:"meta"},Ze={class:"actions"},es=["src"],ss={class:"action-text"},ts=["src"],os={class:"action-text"},ns={class:"recommend-list"},ls=["onClick"],as={class:"thumb-wrapper"},is=["src"],rs={class:"text"},us={class:"mini-tag"},cs={class:"line-popup"},vs="/vip",ds=te({__name:"PlayPage",setup(Q){const v=$e(),c=oe(),U=Fe(),d=o(decodeURIComponent(v.query.src||"")),S=o(!1),t=o(!1),P=o(!1),y=o(!1),w=o(!1),x=o(null),$=o([]),R=o(v.query.views||"0"),p=o(28e3),k=o(7300);function E(){S.value=!S.value,S.value?(p.value++,q("点赞成功")):(p.value--,q("取消点赞"))}function C(){t.value=!t.value,t.value?(k.value++,q("已加入收藏")):(k.value--,q("取消收藏"))}function _(){c.push({name:"PromotionShare"})}ne(()=>{if(v.query.tags)try{$.value=JSON.parse(v.query.tags)}catch{$.value=[]}});function m(){const i=sessionStorage.getItem("return-from");i==="star"?(sessionStorage.getItem("last-star"),sessionStorage.removeItem("return-from"),sessionStorage.removeItem("last-star"),c.back()):i==="darknet"?(sessionStorage.removeItem("return-from"),c.replace({name:"Darknet"})):i==="anime"?(sessionStorage.removeItem("return-from"),c.replace({name:"Acg"})):c.back()}function V(i){localStorage.getItem("token"),d.value=v.query.src,y.value=!1,P.value=!1}function I(){c.push({name:"Vip"})}function T(){c.push({name:"PromotionShare"})}function O(i){c.push({path:"/play",query:{src:encodeURIComponent(i.src),title:i.title,cover:i.cover}})}function F(){U.addRecord({id:d.value,type:"video",time:new Date().toLocaleString(),data:{title:v.query.title||"未知标题",cover:v.query.cover||""}})}function L(i){const s=Number(i);return isNaN(s)?String(i):s>=1e4?(s/1e4).toFixed(2)+"w":s>=1e3?(s/1e3).toFixed(2)+"k":s.toString()}const A=o([{src:"https://zh.sydneyssong.net/001/xxx/xxx.m3u8",cover:"https://dummyimage.com/360x202/333/fff&text=推荐1",title:"标题1",tag:"表表"},{src:"https://zh.sydneyssong.net/001/yyy/yyy.m3u8",cover:"https://dummyimage.com/360x202/555/fff&text=推荐2",title:"标题2",tag:"表表2"}]);return(i,s)=>(r(),u("div",Je,[e("div",{class:"back-btn",onClick:m},s[7]||(s[7]=[e("img",{src:Ie,alt:"返回"},null,-1)])),Ve(Qe,{ref_key:"playerRef",ref:x,src:d.value,poster:N(v).query.cover,onPlay:F,onPreviewEnded:s[0]||(s[0]=a=>P.value=!0)},null,8,["src","poster"]),P.value?(r(),u("div",je,[e("div",null,[s[8]||(s[8]=ee(" 试看已结束，请前往解锁完整视频")),s[9]||(s[9]=e("br",null,null,-1)),e("a",{href:vs},"立即开通 VIP")])])):h("",!0),e("div",Ge,[e("div",Ke,g(N(v).query.title||"视频标题加载中..."),1),e("div",Xe,[(r(!0),u(z,null,W($.value,a=>(r(),u("span",{class:"tag",key:a},"#"+g(a),1))),128)),e("div",{class:"switch-line-btn",onClick:s[1]||(s[1]=a=>y.value=!0)},s[10]||(s[10]=[e("img",{src:Le,class:"icon",alt:"线路图标"},null,-1),ee(" 切换线路 ")]))]),e("div",Ye,"播放量："+g(L(R.value))+"    推荐率：100%",1)]),e("div",Ze,[e("div",{class:"action",onClick:E},[e("img",{src:S.value?"/icons/like7.svg":"/icons/like6.svg",class:"action-icon"},null,8,es),e("div",ss,g(L(p.value)),1)]),e("div",{class:"action",onClick:C},[e("img",{src:t.value?"/icons/star7.svg":"/icons/star6.svg",class:"action-icon"},null,8,ts),e("div",os,g(L(k.value)),1)]),e("div",{class:"action",onClick:_},s[11]||(s[11]=[e("img",{src:Te,class:"action-icon"},null,-1),e("div",{class:"action-text"},"分享",-1)]))]),s[15]||(s[15]=e("div",{class:"section-title"},"猜你喜欢",-1)),e("div",ns,[(r(!0),u(z,null,W(A.value,(a,D)=>(r(),u("div",{class:"card",key:D,onClick:B=>O(a)},[e("div",as,[e("img",{src:a.cover,class:"thumb"},null,8,is)]),e("div",rs,g(a.title),1),e("div",us,g(a.tag),1)],8,ls))),128))]),y.value?(r(),u("div",{key:1,class:"overlay",onClick:s[5]||(s[5]=f(a=>y.value=!1,["self"]))},[e("div",cs,[s[12]||(s[12]=e("div",{class:"popup-option title"},"选择线路",-1)),e("div",{class:"popup-option",onClick:s[2]||(s[2]=a=>V())},"普通线路"),e("div",{class:"popup-option vip",onClick:s[3]||(s[3]=a=>w.value=!0)},"VIP线路"),e("div",{class:"popup-option cancel",onClick:s[4]||(s[4]=a=>y.value=!1)},"取消")])])):h("",!0),w.value?(r(),u("div",{key:2,class:"vip-modal-mask",onClick:s[6]||(s[6]=f(a=>w.value=!1,["self"]))},[e("div",{class:"vip-modal"},[s[13]||(s[13]=e("div",{class:"vip-title"},"温馨提示",-1)),s[14]||(s[14]=e("div",{class:"vip-desc"},"您还不是VIP，本功能只对VIP开放",-1)),e("div",{class:"vip-actions"},[e("button",{class:"btn orange",onClick:T},"邀请好友"),e("button",{class:"btn red",onClick:I},"开通会员")])])])):h("",!0)]))}}),_s=le(ds,[["__scopeId","data-v-de74a9f8"]]);export{_s as default};
