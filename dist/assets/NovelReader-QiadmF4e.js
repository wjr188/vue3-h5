import{d as fe,y as ge,u as _e,r as o,o as he,p as d,k as ke,C as be,c as m,a as f,m as $,b as t,h as z,w as c,t as g,l as Q,O as X,f as P,F as Y,e as Z,z as H,v as ee,D as te,n as Ce}from"./index-CKjozqaQ.js";import{_ as U}from"./dynamic-import-helper-BheWnx7M.js";import{_ as Se}from"./back1-BriTIMyR.js";import{_ as we}from"./share2-DEdzc1xC.js";import{_ as Te,a as ye,b as xe}from"./catalog-BTiaQNIF.js";import{C as Ie}from"./ChapterDrawer-CFwy4oMB.js";import{u as De}from"./useHistoryStore-DEf3NF2P.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./back3-q87-H97k.js";const Ae=""+new URL("../icons/setting3.svg",import.meta.url).href,Ee=""+new URL("../icons/close1.svg",import.meta.url).href,Pe={class:"reader-top-bar"},je={class:"chapter-title"},Fe={key:0,class:"top-tip-message"},Le={class:"bottom-buttons"},Oe=["src"],Ve=["src"],Me={key:0,class:"auto-flip-panel"},Ne={class:"speed-label"},$e={class:"speed-slider"},ze={key:0,class:"reading-settings-panel"},He={class:"panel-header"},Ue={class:"panel-section font-size-row"},Be={class:"font-size-controls"},qe={class:"font-value"},We={class:"panel-section brightness-row"},Ge={class:"panel-section"},Je={class:"theme-options"},Ke=["onClick"],Qe={class:"panel-section"},Xe=["src"],Ye=fe({__name:"NovelReader",setup(Ze){const j=ge(),v=_e(),n=o(""),i=o(null),r=o([]),x=o(""),F=o(""),L=o(""),_=o(!0),a=o(null),I=o(!1),se=o(1),le=o(1),D=o(""),p=o({}),C=o(!1),R=o(3);let S=null;const h=o(!1),k=o(!1),O=o(!1),A=o(17),V=o(1),B=["#ffffff","#fef6d8","#d9f3d6","#cce5ff","#ffd6e7","#f0f0f0"],q=o(B[0]),oe=s=>{document.documentElement.style.setProperty("--reader-bg",s),q.value=s};o([]);const E=o("");let w=null;const M=o(!1),W=()=>{k.value=!k.value},ae=()=>{M.value||(_.value=!_.value,_.value&&(C.value=!1))},ne=()=>{C.value=!0,_.value=!1},b=()=>{h.value=!1,S&&(cancelAnimationFrame(S),S=null),C.value=!1},ie={1:.5,2:1,3:1.5,4:2,5:2.5,6:3},re=()=>{const s=a.value;if(!s)return;h.value=!0,C.value=!1;const e=ie[R.value],l=()=>{if(!h.value)return;const u=s.scrollHeight-s.clientHeight;s.scrollTop<u?(s.scrollTop+=e,S=requestAnimationFrame(l)):b()};S=requestAnimationFrame(l)},ue=()=>{v.push({name:"PromotionShare"})},G=s=>{E.value=s,w&&clearTimeout(w),w=window.setTimeout(()=>E.value="",2e3)},ce=()=>{a.value&&(p.value[String(i.value??"")]=a.value.scrollTop);const s=sessionStorage.getItem("novel-reader-back-from");s?v.replace(s):n.value?v.replace({name:"NovelDetail",params:{id:n.value}}):v.replace("/")},ve=()=>{const s=r.value.findIndex(e=>String(e.id)===String(i.value));s>0?(a.value&&(p.value[String(i.value??"")]=a.value.scrollTop),b(),v.push({name:"NovelReader",params:{comicId:n.value,chapterId:r.value[s-1].id}})):G("这是第一话哦~")},pe=()=>{const s=r.value.findIndex(e=>String(e.id)===String(i.value));s<r.value.length-1?(a.value&&(p.value[String(i.value??"")]=a.value.scrollTop),b(),v.push({name:"NovelReader",params:{comicId:n.value,chapterId:r.value[s+1].id}})):G("这是最后一话哦~")},de=s=>{a.value&&(p.value[String(i.value??"")]=a.value.scrollTop),I.value=!1,b(),M.value=!0,v.push({name:"NovelReader",params:{comicId:n.value,chapterId:s}}).then(()=>{setTimeout(()=>{M.value=!1},200)})},me=()=>{a.value&&(p.value[String(i.value??"")]=a.value.scrollTop)},J=async(s,e)=>{try{const l=await U(Object.assign({"../mock/acg/novel/chapter/1_1.js":()=>d(()=>import("./1_1-CWkr6Efs.js"),[],import.meta.url),"../mock/acg/novel/chapter/1_2.js":()=>d(()=>import("./1_2-BC80yQ9J.js"),[],import.meta.url),"../mock/acg/novel/chapter/1_3.js":()=>d(()=>import("./1_3-DCkJVmNu.js"),[],import.meta.url),"../mock/acg/novel/chapter/1_4.js":()=>d(()=>import("./1_4-kvWg1Odv.js"),[],import.meta.url),"../mock/acg/novel/chapter/1_5.js":()=>d(()=>import("./1_5-QhUkCZb-.js"),[],import.meta.url)}),`../mock/acg/novel/chapter/${s}_${e}.js`,6);L.value=l.default.content||"";const y=((await U(Object.assign({"../mock/acg/novel/detail/1.js":()=>d(()=>import("./1-V7LAkzHJ.js").then(N=>N._),[],import.meta.url)}),`../mock/acg/novel/detail/${s}.js`,6)).default.chapters||[]).find(N=>String(N.id)===String(e));F.value=y?y.title:""}catch{L.value="",F.value=""}Ce(()=>{se.value=1,le.value=1,p.value[String(e)]!==void 0?a.value.scrollTop=p.value[String(e)]:a.value.scrollTop=0})};let K=0;function T(s=!1){const e=Date.now();if(!(!s&&e-K<60*1e3)&&(K=e,n.value)){const l=De(),u=r.value.findIndex(y=>String(y.id)===String(i.value));l.addRecord({id:String(n.value),type:"novel",time:new Date().toISOString(),data:{title:x.value||"未命名小说",cover:D.value||"",author:"佚名",episodes:r.value.length||0,lastRead:u>=0?u+1:1}})}}return he(async()=>{n.value=j.params.comicId,i.value=j.params.chapterId,await J(n.value,i.value);let s=null;try{s=await U(Object.assign({"../mock/acg/novel/detail/1.js":()=>d(()=>import("./1-V7LAkzHJ.js").then(e=>e._),[],import.meta.url)}),`../mock/acg/novel/detail/${n.value}.js`,6),r.value=s.default.chapters||[],x.value=s.default.title||"",D.value=s.default.cover||""}catch{r.value=[],x.value="",D.value=""}T(),sessionStorage.removeItem("novel-reader-back-from")}),ke(()=>j.params.chapterId,async(s,e)=>{s!==e&&(i.value=s,await J(n.value,s),T())}),be(()=>{b(),w&&clearTimeout(w),T(!0),typeof window<"u"&&window.removeEventListener("beforeunload",T)}),typeof window<"u"&&window.addEventListener("beforeunload",()=>T(!0)),(s,e)=>(f(),m("div",{class:H(["comic-reader-wrapper",{"show-controls":_.value,dark:k.value}]),style:P({filter:`brightness(${V.value})`}),onClick:ae},[$(Ie,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=l=>I.value=l),comicId:n.value,comicTitle:x.value,chapters:r.value,cover:D.value,type:"novel",fullScreen:!1,onReadChapterFromDrawer:de},null,8,["modelValue","comicId","comicTitle","chapters","cover"]),t("div",Pe,[t("img",{src:Se,class:"back-icon",onClick:c(ce,["stop"])}),t("span",je,g(F.value),1),t("img",{src:we,class:"share-icon",onClick:c(ue,["stop"])})]),$(X,{name:"fade"},{default:Q(()=>[E.value?(f(),m("div",Fe,g(E.value),1)):z("",!0)]),_:1}),t("div",{class:"comic-pages-container hide-scrollbar",ref_key:"pagesContainer",ref:a,"data-flip-mode":"vertical",style:P({"scroll-snap-type":h.value?"none":"y mandatory"}),onScroll:me},[t("div",{class:"novel-text",style:P({fontSize:A.value+"px"})},[(f(!0),m(Y,null,Z(L.value.split(`
`),(l,u)=>(f(),m("p",{key:u,class:"novel-line"},g(l),1))),128))],4)],36),t("div",{class:"chapter-nav-btn prev-chapter-btn",onClick:c(ve,["stop"])},e[8]||(e[8]=[t("div",{class:"chapter-nav-text prev-text"},"上一话",-1),t("img",{src:Te,class:"chapter-nav-icon"},null,-1)])),t("div",{class:"chapter-nav-btn next-chapter-btn",onClick:c(pe,["stop"])},e[9]||(e[9]=[t("div",{class:"chapter-nav-text next-text"},"下一话",-1),t("img",{src:ye,class:"chapter-nav-icon"},null,-1)])),t("div",{class:H(["reader-bottom-bar",{"show-controls":_.value}])},[t("div",Le,[t("div",{class:"bottom-control-item",onClick:e[1]||(e[1]=c(l=>I.value=!0,["stop"]))},e[10]||(e[10]=[t("img",{src:xe},null,-1),t("span",null,"目录",-1)])),t("div",{class:"bottom-control-item",onClick:c(W,["stop"])},[t("img",{src:k.value?"/icons/sun.svg":"/icons/moon.svg"},null,8,Oe),t("span",null,g(k.value?"日间":"夜间"),1)]),t("div",{class:"bottom-control-item",onClick:c(ne,["stop"])},[t("img",{src:h.value?"/icons/pause1.svg":"/icons/auto-flip.svg"},null,8,Ve),t("span",null,g(h.value?"暂停中":"自动翻"),1)]),t("div",{class:"bottom-control-item",onClick:e[2]||(e[2]=c(l=>O.value=!0,["stop"]))},e[11]||(e[11]=[t("img",{src:Ae,class:"setting-icon"},null,-1),t("span",null,"设置",-1)]))])],2),C.value?(f(),m("div",Me,[t("div",Ne,"自动翻页速度 "+g(R.value),1),t("div",$e,[e[12]||(e[12]=t("span",null,"减速",-1)),ee(t("input",{type:"range",min:"1",max:"6","onUpdate:modelValue":e[3]||(e[3]=l=>R.value=l)},null,512),[[te,R.value]]),e[13]||(e[13]=t("span",null,"加速",-1))]),t("div",{class:"button-group"},[t("button",{class:"stop-btn",onClick:b},"结束自动翻页"),t("button",{class:"start-btn",onClick:re},"开始")])])):z("",!0),$(X,{name:"fade"},{default:Q(()=>[O.value?(f(),m("div",ze,[t("div",He,[e[14]||(e[14]=t("h3",{class:"panel-title"},"阅读设置",-1)),t("img",{src:Ee,class:"close-icon",onClick:e[4]||(e[4]=l=>O.value=!1)})]),t("div",Ue,[e[15]||(e[15]=t("span",{class:"label"},"文章字号",-1)),t("div",Be,[t("button",{class:"btn",onClick:e[5]||(e[5]=l=>A.value--)},"A-"),t("span",qe,g(A.value),1),t("button",{class:"btn",onClick:e[6]||(e[6]=l=>A.value++)},"A+")])]),t("div",We,[e[16]||(e[16]=t("span",{class:"label"},"调整亮度",-1)),ee(t("input",{class:"slider",type:"range",min:"0.5",max:"1.2",step:"0.01","onUpdate:modelValue":e[7]||(e[7]=l=>V.value=l)},null,512),[[te,V.value]])]),t("div",Ge,[e[17]||(e[17]=t("span",null,"主题颜色",-1)),t("div",Je,[(f(),m(Y,null,Z(B,(l,u)=>t("div",{key:u,class:H(["theme-dot",{active:q.value===l}]),style:P({background:l}),onClick:y=>oe(l)},null,14,Ke)),64))])]),t("div",Qe,[e[18]||(e[18]=t("span",null,"深色模式",-1)),t("img",{src:k.value?"/icons/setting-active.svg":"/icons/setting.svg",class:"darkmode-toggle",onClick:W},null,8,Xe)])])):z("",!0)]),_:1})],6))}}),ut=Re(Ye,[["__scopeId","data-v-49822721"]]);export{ut as default};
