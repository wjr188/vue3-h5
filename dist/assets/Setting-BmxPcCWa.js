import{d as q,J as G,L as J,q as w,r as m,o as K,c as d,a as p,b as s,h as g,t as v,w as O,v as C,D as h,z as M}from"./index-CKjozqaQ.js";import{_ as z}from"./back3-q87-H97k.js";import{_ as L}from"./more-arrow-9umo57Y-.js";import{_ as H}from"./close-DWpgVr8i.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W=""+new URL("../icons/camera.svg",import.meta.url).href,x=""+new URL("../icons/profile.svg",import.meta.url).href,X=""+new URL("../icons/profile-active.svg",import.meta.url).href,Y=""+new URL("../icons/invite.svg",import.meta.url).href,R=""+new URL("../icons/lock.svg",import.meta.url).href,ee={class:"profile-setting-wrapper"},se={class:"avatar-block"},te=["src"],ae={class:"info-list"},oe={class:"info-item"},le={class:"value-wrap"},ne={class:"value"},ie={class:"info-item"},re={class:"value"},ue={key:0,class:"info-item"},ce={class:"value"},ve={class:"value"},me={class:"bottom-btns-fixed"},de={key:0,class:"toast-mask"},pe={key:1,class:"bind-form-mask"},fe={class:"bind-form-container"},ge={class:"form-header"},we={class:"form-title"},_e={class:"input-item"},be={class:"input-item"},ke=["autocomplete"],ye={key:0,class:"input-item"},Te={class:"form-fixed-footer"},Ce=q({__name:"Setting",setup(he){const i=G(),{userInfo:r}=J(i),k=w(()=>!!r.value?.account),T=w(()=>r.value?.uuid||""),D=w(()=>r.value?.nickname||""),V=w(()=>r.value?.avatar||""),I=w(()=>r.value?.account||""),$=w(()=>!!r.value?.isVIP||!!r.value?.is_vip||!!r.value?.vip_status),u=m(!1),_=m(""),a=m(!1),n=m(""),y=m(!1),f=m("register"),B=m("0B"),o=m({username:"",password:"",confirmPassword:""});K(async()=>{if(i.token)try{await i.fetchUserInfo()}catch{i.logout()}U()});const A=()=>{if(!$.value){_.value="充值会员才可以修改资料~",u.value=!0,setTimeout(()=>u.value=!1,2e3);return}const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=e=>{const c=e.target.files?.[0];if(!c)return;if(c.size>1024*1024){_.value="头像不能超过1MB~",u.value=!0,setTimeout(()=>u.value=!1,2e3);return}const b=new FileReader;b.onload=()=>{_.value="请接入头像上传接口",u.value=!0,setTimeout(()=>u.value=!1,2e3)},b.readAsDataURL(c)},t.click()},U=()=>{let t=0;Object.keys(localStorage).forEach(l=>{const c=localStorage.getItem(l),b=l.length+(c?c.length:0);t+=b}),B.value=E(t)},E=t=>{if(t===0)return"0B";const e=1024,l=["B","KB","MB","GB"],c=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,c)).toFixed(2)+l[c]},F=()=>window.history.back(),N=()=>{const t=localStorage.getItem("user");localStorage.clear(),t&&localStorage.setItem("user",t),U(),_.value="缓存清理成功~",u.value=!0,setTimeout(()=>u.value=!1,1500)},S=t=>{if(t==="register"&&r.value?.account){n.value="当前用户已绑定账号，不能重复绑定！",a.value=!0,setTimeout(()=>a.value=!1,1800);return}f.value=t,o.value.username="",o.value.password="",o.value.confirmPassword="",y.value=!0},Z=async()=>{try{const t=T.value;if(!t){n.value="用户ID为空，无法复制",a.value=!0,setTimeout(()=>a.value=!1,1500);return}if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(t);else{const e=document.createElement("textarea");e.value=t,e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}n.value="用户ID已复制~",a.value=!0,setTimeout(()=>a.value=!1,1500)}catch(t){console.error("复制失败:",t),n.value="复制失败，请手动复制",a.value=!0,setTimeout(()=>a.value=!1,1500)}},P=async()=>{if(!o.value.username||!o.value.password){n.value="请填写账号和密码",a.value=!0,setTimeout(()=>a.value=!1,1500);return}if(!/^[a-zA-Z0-9_.\-@]{6,}$/.test(o.value.username)){n.value="账号必须6位及以上，仅限字母、数字、_ . - @",a.value=!0,setTimeout(()=>a.value=!1,1800);return}if(!/^[a-zA-Z0-9_.\-@]{6,}$/.test(o.value.password)){n.value="密码必须6位及以上，仅限字母、数字、_ . - @",a.value=!0,setTimeout(()=>a.value=!1,1800);return}if(f.value==="register"&&o.value.password!==o.value.confirmPassword){n.value="两次密码输入不一致",a.value=!0,setTimeout(()=>a.value=!1,1500);return}try{f.value==="login"?(await i.login(o.value.username,o.value.password),await i.fetchUserInfo(),n.value="登录成功"):(await i.register(o.value.username,o.value.password,T.value),await i.fetchUserInfo(),n.value="绑定成功"),a.value=!0,setTimeout(()=>{a.value=!1,y.value=!1},1e3)}catch(l){n.value=l?.msg||l?.message||"操作失败，请重试",a.value=!0,setTimeout(()=>a.value=!1,1500)}},j=()=>{i.logout()};return(t,e)=>(p(),d("div",ee,[s("div",{class:"header-bar"},[s("img",{src:z,class:"back-icon",onClick:F}),e[6]||(e[6]=s("span",{class:"title"},"个人设置",-1))]),s("div",se,[s("img",{class:"avatar-img",src:V.value},null,8,te),s("div",{class:"edit-avatar",onClick:A},e[7]||(e[7]=[s("img",{src:W},null,-1)])),e[8]||(e[8]=s("div",{class:"avatar-text"},"修改头像",-1))]),s("div",ae,[s("div",oe,[e[9]||(e[9]=s("img",{src:x,class:"info-icon"},null,-1)),e[10]||(e[10]=s("span",{class:"label"},"用户ID",-1)),s("div",le,[s("span",ne,v(T.value),1),s("button",{class:"copy-btn",onClick:Z},"复制")])]),s("div",ie,[e[11]||(e[11]=s("img",{src:X,class:"info-icon"},null,-1)),e[12]||(e[12]=s("span",{class:"label"},"昵称",-1)),s("span",re,v(D.value),1),e[13]||(e[13]=s("img",{src:L,class:"arrow"},null,-1))]),k.value&&I.value?(p(),d("div",ue,[e[14]||(e[14]=s("img",{src:x,class:"info-icon"},null,-1)),e[15]||(e[15]=s("span",{class:"label"},"账号绑定",-1)),s("span",ce,v(I.value),1)])):g("",!0),s("div",{class:"info-item",onClick:N},[e[16]||(e[16]=s("img",{src:H,class:"info-icon"},null,-1)),e[17]||(e[17]=s("span",{class:"label"},"清理缓存",-1)),s("span",ve,v(B.value),1),e[18]||(e[18]=s("img",{src:L,class:"arrow"},null,-1))]),e[19]||(e[19]=s("div",{class:"info-item"},[s("img",{src:Y,class:"info-icon"}),s("span",{class:"label"},"版本更新"),s("span",{class:"value"},"v2.4.1")],-1))]),s("div",me,[k.value?g("",!0):(p(),d("button",{key:0,class:"main-btn",onClick:e[0]||(e[0]=l=>S("login"))},"登录")),k.value?g("",!0):(p(),d("button",{key:1,class:"main-btn",onClick:e[1]||(e[1]=l=>S("register"))},"注册绑定")),k.value?(p(),d("button",{key:2,class:"main-btn",onClick:j},"退出登录")):g("",!0)]),u.value?(p(),d("div",de,v(_.value),1)):g("",!0),y.value?(p(),d("div",pe,[s("div",fe,[s("div",ge,[s("img",{src:z,class:"back-icon",onClick:e[2]||(e[2]=l=>y.value=!1)}),s("span",we,v(f.value==="login"?"登录":"绑定"),1)]),s("form",{class:"form-body",onSubmit:O(P,["prevent"])},[s("div",_e,[e[20]||(e[20]=s("img",{src:x,class:"input-icon"},null,-1)),C(s("input",{type:"text",placeholder:"请输入账号","onUpdate:modelValue":e[3]||(e[3]=l=>o.value.username=l),autocomplete:"username"},null,512),[[h,o.value.username]])]),s("div",be,[e[21]||(e[21]=s("img",{src:R,class:"input-icon"},null,-1)),C(s("input",{type:"password",placeholder:"请输入你的密码","onUpdate:modelValue":e[4]||(e[4]=l=>o.value.password=l),autocomplete:f.value==="register"?"new-password":"current-password"},null,8,ke),[[h,o.value.password]])]),f.value==="register"?(p(),d("div",ye,[e[22]||(e[22]=s("img",{src:R,class:"input-icon"},null,-1)),C(s("input",{type:"password",placeholder:"请再次输入你的密码","onUpdate:modelValue":e[5]||(e[5]=l=>o.value.confirmPassword=l),autocomplete:"new-password"},null,512),[[h,o.value.confirmPassword]])])):g("",!0)],32),s("div",Te,[s("button",{class:"main-btn",onClick:P},v(f.value==="login"?"登录":"绑定"),1)]),s("div",{class:M(["form-toast-mask",{show:a.value}])},v(n.value),3)])])):g("",!0),s("div",{class:M(["form-toast-mask",{show:a.value}])},v(n.value),3)]))}}),Pe=Q(Ce,[["__scopeId","data-v-a6b1c4d4"]]);export{Pe as default};
