import{aP as Ve,aQ as we,aR as Ee,aJ as Me,aS as Te,d as oe,Z as Be,$ as Le,aT as Pe,aF as Re,r as V,ap as Ae,aU as Ne,q as k,ac as p,an as ze,k as De,n as L,o as Oe,ae as We,m as c,aV as x,aW as ee,aX as Fe,al as qe,ag as F,a6 as q,a3 as A,aa as $e,a9 as U,aI as je,x as H,G as te,aY as Ue,aZ as He,a_ as Je,Q as Ke,u as Ye,J as Qe,L as Ze,c as ne,a as ae,b as $,at as Ge,h as Xe,i as P,l as pe,t as et,M as R}from"./index-CKjozqaQ.js";/* empty css              */import{C as tt,c as nt}from"./index-_d8olbqR.js";/* empty css              */import{B as at}from"./index-BvDqeyKw.js";import{_ as it}from"./_plugin-vue_export-helper-DlAUqK2U.js";function re(e){return Array.isArray(e)?!e.length:e===0?!1:!e}function lt(e,n){if(re(e)){if(n.required)return!1;if(n.validateEmpty===!1)return!0}return!(n.pattern&&!n.pattern.test(String(e)))}function ot(e,n){return new Promise(o=>{const u=n.validator(e,n);if(Te(u)){u.then(o);return}o(u)})}function ie(e,n){const{message:o}=n;return Me(o)?o(e,n):o||""}function rt({target:e}){e.composing=!0}function le({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function st(e,n){const o=Ve();e.style.height="auto";let u=e.scrollHeight;if(we(n)){const{maxHeight:l,minHeight:d}=n;l!==void 0&&(u=Math.min(u,l)),d!==void 0&&(u=Math.max(u,d))}u&&(e.style.height=`${u}px`,Ee(o))}function ct(e,n){return e==="number"&&(e="text",n??(n="decimal")),e==="digit"&&(e="tel",n??(n="numeric")),{type:e,inputmode:n}}function v(e){return[...e].length}function j(e,n){return[...e].slice(0,n).join("")}const[ut,m]=Le("field"),dt={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:U,max:Number,min:Number,formatter:Function,clearIcon:A("clear"),modelValue:$e(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:A("focus"),formatTrigger:A("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},inputmode:String},ft=Be({},nt,dt,{rows:U,type:A("text"),rules:Array,autosize:[Boolean,Object],labelWidth:U,labelClass:je,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var gt=oe({name:ut,props:ft,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:n,slots:o}){const u=Pe(),l=Re({status:"unvalidated",focused:!1,validateMessage:""}),d=V(),I=V(),C=V(),{parent:g}=Ae(Ne),y=()=>{var t;return String((t=e.modelValue)!=null?t:"")},r=t=>{if(x(e[t]))return e[t];if(g&&x(g.props[t]))return g.props[t]},N=k(()=>{const t=r("readonly");if(e.clearable&&!t){const a=y()!=="",i=e.clearTrigger==="always"||e.clearTrigger==="focus"&&l.focused;return a&&i}return!1}),w=k(()=>C.value&&o.input?C.value():e.modelValue),z=k(()=>{var t;const a=r("required");return a==="auto"?(t=e.rules)==null?void 0:t.some(i=>i.required):a}),D=t=>t.reduce((a,i)=>a.then(()=>{if(l.status==="failed")return;let{value:s}=w;if(i.formatter&&(s=i.formatter(s,i)),!lt(s,i)){l.status="failed",l.validateMessage=ie(s,i);return}if(i.validator)return re(s)&&i.validateEmpty===!1?void 0:ot(s,i).then(f=>{f&&typeof f=="string"?(l.status="failed",l.validateMessage=f):f===!1&&(l.status="failed",l.validateMessage=ie(s,i))})}),Promise.resolve()),E=()=>{l.status="unvalidated",l.validateMessage=""},J=()=>n("endValidate",{status:l.status,message:l.validateMessage}),K=(t=e.rules)=>new Promise(a=>{E(),t?(n("startValidate"),D(t).then(()=>{l.status==="failed"?(a({name:e.name,message:l.validateMessage}),J()):(l.status="passed",a(),J())})):a()}),O=t=>{if(g&&e.rules){const{validateTrigger:a}=g.props,i=ee(a).includes(t),s=e.rules.filter(f=>f.trigger?ee(f.trigger).includes(t):i);s.length&&K(s)}},se=t=>{var a;const{maxlength:i}=e;if(x(i)&&v(t)>+i){const s=y();if(s&&v(s)===+i)return s;const f=(a=d.value)==null?void 0:a.selectionEnd;if(l.focused&&f){const _=[...t],S=_.length-+i;return _.splice(f-S,S),_.join("")}return j(t,+i)}return t},M=(t,a="onChange")=>{var i,s;const f=t;t=se(t);const _=v(f)-v(t);if(e.type==="number"||e.type==="digit"){const h=e.type==="number";if(t=Fe(t,h,h),a==="onBlur"&&t!==""&&(e.min!==void 0||e.max!==void 0)){const b=qe(+t,(i=e.min)!=null?i:-1/0,(s=e.max)!=null?s:1/0);+t!==b&&(t=b.toString())}}let S=0;if(e.formatter&&a===e.formatTrigger){const{formatter:h,maxlength:b}=e;if(t=h(t),x(b)&&v(t)>+b&&(t=j(t,+b)),d.value&&l.focused){const{selectionEnd:B}=d.value,X=j(f,B);S=v(h(X))-v(X)}}if(d.value&&d.value.value!==t)if(l.focused){let{selectionStart:h,selectionEnd:b}=d.value;if(d.value.value=t,x(h)&&x(b)){const B=v(t);_?(h-=_,b-=_):S&&(h+=S,b+=S),d.value.setSelectionRange(Math.min(h,B),Math.min(b,B))}}else d.value.value=t;t!==e.modelValue&&n("update:modelValue",t)},ce=t=>{t.target.composing||M(t.target.value)},W=()=>{var t;return(t=d.value)==null?void 0:t.blur()},Y=()=>{var t;return(t=d.value)==null?void 0:t.focus()},T=()=>{const t=d.value;e.type==="textarea"&&e.autosize&&t&&st(t,e.autosize)},ue=t=>{l.focused=!0,n("focus",t),L(T),r("readonly")&&W()},de=t=>{l.focused=!1,M(y(),"onBlur"),n("blur",t),!r("readonly")&&(O("onBlur"),L(T),Ue())},Q=t=>n("clickInput",t),fe=t=>n("clickLeftIcon",t),ge=t=>n("clickRightIcon",t),me=t=>{F(t),n("update:modelValue",""),n("clear",t)},Z=k(()=>{if(typeof e.error=="boolean")return e.error;if(g&&g.props.showError&&l.status==="failed")return!0}),be=k(()=>{const t=r("labelWidth"),a=r("labelAlign");if(t&&a!=="top")return{width:p(t)}}),he=t=>{t.keyCode===13&&(!(g&&g.props.submitOnEnter)&&e.type!=="textarea"&&F(t),e.type==="search"&&W()),n("keypress",t)},G=()=>e.id||`${u}-input`,ve=()=>l.status,ye=()=>{const t=m("control",[r("inputAlign"),{error:Z.value,custom:!!o.input,"min-height":e.type==="textarea"&&!e.autosize}]);if(o.input)return c("div",{class:t,onClick:Q},[o.input()]);const a={id:G(),ref:d,name:e.name,rows:e.rows!==void 0?+e.rows:void 0,class:t,disabled:r("disabled"),readonly:r("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,autocapitalize:e.autocapitalize,autocorrect:e.autocorrect,enterkeyhint:e.enterkeyhint,spellcheck:e.spellcheck,"aria-labelledby":e.label?`${u}-label`:void 0,"data-allow-mismatch":"attribute",onBlur:de,onFocus:ue,onInput:ce,onClick:Q,onChange:le,onKeypress:he,onCompositionend:le,onCompositionstart:rt};return e.type==="textarea"?c("textarea",te(a,{inputmode:e.inputmode}),null):c("input",te(ct(e.type,e.inputmode),a),null)},Ie=()=>{const t=o["left-icon"];if(e.leftIcon||t)return c("div",{class:m("left-icon"),onClick:fe},[t?t():c(q,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])},Ce=()=>{const t=o["right-icon"];if(e.rightIcon||t)return c("div",{class:m("right-icon"),onClick:ge},[t?t():c(q,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},_e=()=>{if(e.showWordLimit&&e.maxlength){const t=v(y());return c("div",{class:m("word-limit")},[c("span",{class:m("word-num")},[t]),H("/"),e.maxlength])}},Se=()=>{if(g&&g.props.showErrorMessage===!1)return;const t=e.errorMessage||l.validateMessage;if(t){const a=o["error-message"],i=r("errorMessageAlign");return c("div",{class:m("error-message",i)},[a?a({message:t}):t])}},ke=()=>{const t=r("labelWidth"),a=r("labelAlign"),i=r("colon")?":":"";if(o.label)return[o.label(),i];if(e.label)return c("label",{id:`${u}-label`,for:o.input?void 0:G(),"data-allow-mismatch":"attribute",onClick:s=>{F(s),Y()},style:a==="top"&&t?{width:p(t)}:void 0},[e.label+i])},xe=()=>[c("div",{class:m("body")},[ye(),N.value&&c(q,{ref:I,name:e.clearIcon,class:m("clear")},null),Ce(),o.button&&c("div",{class:m("button")},[o.button()])]),_e(),Se()];return ze({blur:W,focus:Y,validate:K,formValue:w,resetValidation:E,getValidationStatus:ve}),He(Je,{customValue:C,resetValidation:E,validateWithTrigger:O}),De(()=>e.modelValue,()=>{M(y()),E(),O("onChange"),L(T)}),Oe(()=>{M(y(),e.formatTrigger),L(T)}),We("touchstart",me,{target:k(()=>{var t;return(t=I.value)==null?void 0:t.$el})}),()=>{const t=r("disabled"),a=r("labelAlign"),i=Ie(),s=()=>{const f=ke();return a==="top"?[i,f].filter(Boolean):f||[]};return c(tt,{size:e.size,class:m({error:Z.value,disabled:t,[`label-${a}`]:a}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:be.value,valueClass:m("value"),titleClass:[m("label",[a,{required:z.value}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:i&&a!=="top"?()=>i:null,title:s,value:xe,extra:o.extra})}}});const mt=Ke(gt),bt={class:"invite-page"},ht={class:"invite-content"},vt={key:0,class:"already-bound"},yt=oe({__name:"InviteCodePage",setup(e){const n=Ye();function o(){n.back()}const u=Qe(),{parentInviteCode:l,userId:d}=Ze(u),I=V(""),C=V(!1);async function g(){if(!I.value){R("请输入邀请码");return}if(l.value){R("您已填写过邀请码");return}C.value=!0;try{R("模拟绑定成功"),u.setParentInviteCode(I.value)}catch{R("网络错误")}finally{C.value=!1}}return(y,r)=>{const N=Ge,w=mt,z=at;return ae(),ne("div",bt,[c(N,{title:"填写邀请码","left-arrow":"",fixed:"","safe-area-inset-top":"",onClickLeft:o}),$("div",ht,[r[3]||(r[3]=$("div",{class:"tip-text"}," * 填写邀请你下载用户的邀请码 * ",-1)),c(w,{modelValue:I.value,"onUpdate:modelValue":r[0]||(r[0]=D=>I.value=D),placeholder:"请输入邀请码",disabled:!!P(l),class:"custom-input"},null,8,["modelValue","disabled"]),c(z,{round:"",block:"",type:"primary",class:"submit-btn",loading:C.value,disabled:!!P(l),onClick:g},{default:pe(()=>r[1]||(r[1]=[H(" 确定 ")])),_:1,__:[1]},8,["loading","disabled"]),P(l)?(ae(),ne("div",vt,[r[2]||(r[2]=H(" 您已填写过邀请码：")),$("span",null,et(P(l)),1)])):Xe("",!0)])])}}}),Vt=it(yt,[["__scopeId","data-v-938b56d3"]]);export{Vt as default};
