import{Q as J,d as Q,J as j,u as G,r as i,k as C,o as K,A as X,c as p,a as m,b as o,h as P,i as L,x as g,w as U,q as Y,z as Z,v as ee,f as $,D as te,t as D}from"./index-CKjozqaQ.js";import{H as M,_ as se}from"./hls-AJDOUA6Y.js";import{a as oe,s as ae}from"./function-call-Cn_FLeOo.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";J(oe);const Pe=""+new URL("../icons/share1.svg",import.meta.url).href,re=""+new URL("../icons/pause.svg",import.meta.url).href,ne=["poster","controls"],ie={key:0,class:"center-icon icon-play"},le={key:1,class:"center-icon icon-pause"},ue={key:2,class:"tip-mask"},de={class:"tip-box"},ce={key:3,class:"tip-mask"},ve={class:"tip-box"},pe=Q({__name:"NativePlayer",props:{src:{},cover:{},shouldPlay:{type:Boolean}},emits:["requestPlay","timeUpdate","played"],setup(b,{expose:S,emit:f}){const y=j(),d=G(),a=b,h=f,l=i(null),w=i(null),c=i(!1),u=i(!0),k=i(!1);let r=!1,s=null;const n=navigator.userAgent,O=/Android/i.test(n),E=/iP(hone|od|ad)/i.test(n),q=/UCBrowser|Quark|Baidu|QQBrowser/i.test(n),z=O&&/QQBrowser|360/i.test(n),v=E&&q,N=i(v),A=i(z),F=E&&document.createElement("video").canPlayType("application/vnd.apple.mpegurl")!=="";let T=null;const _=()=>{const t=l.value;t&&!t.paused&&(h("timeUpdate",{currentTime:t.currentTime,duration:t.duration,buffered:t.buffered}),T=requestAnimationFrame(_))},x=()=>{T!==null&&(cancelAnimationFrame(T),T=null)},W=async()=>{const t=l.value;if(!(!t||v)){if(!r){if(r=!0,!y.isVIP){if(!y.canWatchDyVideo()){await ae({title:"温馨提示",message:"抖阴观看次数已用完，请开通VIP",confirmButtonText:"立即开通",cancelButtonText:"取消",className:"vip-dialog",closeOnClickOverlay:!0}).then(()=>{d.push("/VIP")}).catch(()=>{});return}y.consumeDyVideo()}t.muted=!1;try{await t.play(),c.value=!0,u.value=!0,setTimeout(()=>u.value=!1,800),_(),h("played")}catch(e){console.warn("第一次播放失败",e)}return}if(t.paused)try{await t.play(),c.value=!0,u.value=!0,setTimeout(()=>u.value=!1,800),_()}catch(e){console.warn("播放失败",e)}else t.pause(),c.value=!1,k.value=!0,setTimeout(()=>k.value=!1,800),x()}};C(()=>a.shouldPlay,async t=>{const e=l.value;if(t&&r&&e&&!e.ended&&!e.seeking&&e.paused&&!v)try{await e.play(),c.value=!0,u.value=!1,_(),h("played")}catch(I){console.warn("自动播放失败",I)}}),C(()=>a.src,t=>{R(t)});const R=t=>{const e=l.value;!e||!t||(x(),s&&(s.destroy(),s=null),e.removeEventListener("loadeddata",V),e.removeEventListener("error",B),M.isSupported()&&t.trim().endsWith(".m3u8")&&!F&&!v?(s=new M,s.loadSource(t.trim()),s.attachMedia(e)):e.src=t.trim(),e.addEventListener("loadeddata",V),e.addEventListener("error",B))};function V(){}function B(){console.error("视频加载失败")}return K(()=>{R(a.src),w.value&&w.value.addEventListener("click",W)}),X(()=>{const t=l.value;t&&(t.pause(),x(),t.removeEventListener("loadeddata",V),t.removeEventListener("error",B),t.removeAttribute("src"),t.load()),s&&(s.destroy(),s=null)}),S({seekTo(t){const e=l.value;e&&(e.currentTime=t,e.paused&&(e.play().catch(()=>{}),c.value=!0,_()))}}),(t,e)=>(m(),p("div",{class:"video-wrapper",ref_key:"wrapperRef",ref:w},[o("video",{ref_key:"videoRef",ref:l,class:"native-player",poster:t.cover,playsinline:"","webkit-playsinline":"","x5-video-player-type":"h5","x5-video-player-fullscreen":"true",preload:"auto",muted:"",controls:L(v)},null,8,ne),u.value&&!L(v)?(m(),p("div",ie,e[2]||(e[2]=[o("img",{src:se},null,-1)]))):P("",!0),k.value&&!L(v)?(m(),p("div",le,e[3]||(e[3]=[o("img",{src:re},null,-1)]))):P("",!0),N.value?(m(),p("div",ue,[o("div",de,[e[4]||(e[4]=o("div",{class:"tip-text"},[g(" 当前浏览器限制播放体验"),o("br"),g(" 请使用 "),o("span",{class:"highlight"},"Safari"),g(" 或 "),o("span",{class:"highlight"},"Chrome"),g(" 打开观看 ")],-1)),o("div",{class:"close-btn",onClick:e[0]||(e[0]=U(I=>N.value=!1,["stop"]))},"✕")])])):P("",!0),A.value?(m(),p("div",ce,[o("div",ve,[e[5]||(e[5]=o("div",{class:"tip-text"},[g(" 当前浏览器限制播放体验"),o("br"),g(" 请使用其他浏览器打开 ")],-1)),o("div",{class:"close-btn",onClick:e[1]||(e[1]=U(I=>A.value=!1,["stop"]))},"✕")])])):P("",!0)],512))}}),Te=H(pe,[["__scopeId","data-v-48220ac7"]]),me=["max"],fe={key:0,class:"time-text"},ye=Q({__name:"VideoProgress",props:{currentTime:{},duration:{}},emits:["seek","seeking"],setup(b,{emit:S}){const f=b,y=S,d=i(!1),a=i(f.currentTime),h=i(0),l=()=>{};C(()=>f.currentTime,r=>{d.value||(a.value=r)});const w=()=>{y("seeking",a.value)},c=()=>{y("seek",a.value),d.value=!1},u=r=>{const s=String(Math.floor(r/60)).padStart(2,"0"),n=String(Math.floor(r%60)).padStart(2,"0");return`${s}:${n}`},k=Y(()=>f.duration?a.value/f.duration*100:0);return(r,s)=>(m(),p("div",{class:Z(["progress-bar-container",{dragging:d.value}]),onClick:l},[s[3]||(s[3]=o("div",{class:"bg-bar"},null,-1)),o("div",{class:"buffered-bar",style:$({width:h.value+"%"})},null,4),o("div",{class:"played-bar",style:$({width:k.value+"%"})},null,4),ee(o("input",{class:"progress-bar",type:"range",max:r.duration,step:"0.1","onUpdate:modelValue":s[0]||(s[0]=n=>a.value=n),onMousedown:s[1]||(s[1]=n=>d.value=!0),onMouseup:c,onInput:w,onTouchstart:s[2]||(s[2]=n=>d.value=!0),onTouchend:c},null,40,me),[[te,a.value]]),d.value?(m(),p("div",fe,D(u(a.value))+" / "+D(u(r.duration)),1)):P("",!0)],2))}}),be=H(ye,[["__scopeId","data-v-dbe2d1d7"]]);export{Te as N,be as V,Pe as _};
