import{b1 as v,r}from"./index-CKjozqaQ.js";const w=v("history",()=>{const a=r([]);function u(e){if(d(),e.type==="only_img"){const t={album:e.data.album,star:e.data.star,likes:e.data.likes??0,favs:e.data.favs??0,index:e.data.index??0};e.id=encodeURIComponent(JSON.stringify(t))}if(e.type==="comic"||e.type==="novel"){e.data.episodes??=0,e.data.lastRead??=0;const t=e.id.split("_")[0];a.value=a.value.filter(i=>i.type===e.type?i.id.split("_")[0]!==t:!0),a.value.unshift(e)}else a.value=a.value.filter(t=>!(t.id===e.id&&t.type===e.type)),a.value.unshift(e);o()}function f(e,t){const i=a.value.find(n=>n.id===e&&(n.type==="comic"||n.type==="novel"));i&&(i.data.lastRead=t,o())}function c(e,t){a.value=a.value.filter(i=>!(i.id===e&&i.type===t)),o()}function m(){a.value=[],o()}function p(e){return a.value.filter(t=>t.type===e)}function o(){try{localStorage.setItem("historyRecords",JSON.stringify(a.value))}catch(e){console.warn("保存浏览记录失败:",e)}}function y(){const e=localStorage.getItem("historyRecords");if(e)try{const t=JSON.parse(e),i=Date.now(),n=new Map;for(const s of[...t,...a.value]){const l=`${s.id}_${s.type}`;i-new Date(s.time).getTime()>30*24*60*60*1e3||n.has(l)||n.set(l,s)}a.value=Array.from(n.values()).sort((s,l)=>new Date(l.time).getTime()-new Date(s.time).getTime()).slice(0,200)}catch(t){console.warn("加载浏览记录失败:",t),a.value=[]}}function d(){const e=Date.now();a.value=a.value.filter(t=>e-new Date(t.time).getTime()<=30*24*60*60*1e3).sort((t,i)=>new Date(i.time).getTime()-new Date(t.time).getTime()).slice(0,200)}return{records:a,addRecord:u,updateLastRead:f,removeRecord:c,clearAll:m,getRecordsByType:p,saveToLocal:o,loadFromLocal:y}});export{w as u};
